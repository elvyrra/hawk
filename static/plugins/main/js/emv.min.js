/**
 * emv.js 2.0.0-2
 *
 * @author Elvyrra S.A.S
 * @license http://rem.mit-license.org/ MIT
 */
"use strict";!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EMV=t()}(this,function(){function e(){const e=()=>{return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e){let t=["string","number","boolean","undefined","symbol"];return-1!==t.indexOf(typeof e)||null===e}function i(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}class n extends Error{constructor(e){let t=`EMV Error : ${e}`;super(t)}}class r{constructor(e,t,i,n){this.$computed={};this.$observed=new Set([]);this.$callers={};this.$watchers={};this.$root=t||this;this.$parent=i;this.$this=this;this.$directives={};this.$object=e;this.$additionalProperties=new Set([]);Object.keys(e).forEach((t=>{this.$observe(t,e[t],n)}));if(e.constructor.name!=="Object"){Object.getOwnPropertyNames(e.constructor.prototype).forEach((t=>{if(!this.constructor.prototype[t]){this.constructor.prototype[t]=e.constructor.prototype[t]}}))}}$observe(e,i,n){if(this.$observed.has(e)){return}const c={get:function(){let t=this.$object[e];if(this.$root&&typeof t!=="function"){if(this.$root.$executingComputed){if(!this.$callers[e]){this.$callers[e]={}}if(!this.$callers[e][this.$root.$executingComputed.uid]){const i=this.$root.$executingComputed;const n=i.object;Object.keys(n.$computed).every(function(t){if(n.$computed[t]===i){this.$callers[e][i.uid]={property:t,reader:i.reader,writer:i.writer,object:i.object};return false}return true}.bind(this))}}if(this.$root.$executingDirective){if(!this.$directives[e]){this.$directives[e]=new Set([])}this.$directives[e].add(this.$root.$executingDirective.uid)}}return t}.bind(this),set:function(i){let c=false;if(!(e in this.$object)&&!this.$root.$creatingContext){c=true}if(typeof i==="function"||i instanceof HTMLElement){this.$object[e]=i;return true}let s=this.$object[e];if(!t(i)&&!(i instanceof r)){if(Array.isArray(i)){this.$object[e]=new o(i,this.$root||this,this,e)}else{this.$object[e]=new r(i,this.$root||this,this,e)}}else{this.$object[e]=i;if(i instanceof a){i.$setRoot(this.$root||this);i.$parent=this}}if(this.$computed[e]&&this.$computed[e].writer){try{this.$computed[e].writer(this,i,s)}catch(u){}}if(s!==i){this.$notifySubscribers(e,i,s);if(c&&this.$parent){this.$parent.$notifySubscribers(n,this.$parent)}}return true}.bind(this),enumerable:true,configurable:true};Object.defineProperty(this,e,c);this.$observed.add(e);this[e]=i}$setRoot(e){this.$root=e;Object.keys(this.$object).forEach((t=>{if(this.$object[t]instanceof r){this.$object[t].$setRoot(e)}}))}$notifySubscribers(e,t,i){if(!e){return}if(t===undefined){t=this[e]}if(this.$callers[e]){Object.keys(this.$callers[e]).forEach(function(t){const i=this.$callers[e][t];i.object[i.property]=i.reader(i.object)}.bind(this))}if(this.$watchers[e]){Object.keys(this.$watchers[e]).forEach(function(n){this.$watchers[e][n].call(this,t,i)}.bind(this))}if(this.$directives[e]){this.$directives[e].forEach(function(t){const i=this.$root.$directives[t];if(!i){this.$directives[e].delete(t);return}if(i&&i.handler.update){i.handler.update(i.element,i.parameters,i.model)}}.bind(this))}}valueOf(){let e={};Object.keys(this).forEach((t=>{e[t]=this[t]?this[t].valueOf():this[t]}));return e}toString(){return JSON.stringify(this.valueOf())}$watch(t,i){if(Array.isArray(t)){t.forEach((e=>{this.$watch(e,i)}));return}let n=t.split("."),r,o=n.pop();r=this.$this;n.forEach(function(e){r=r[e]});if(!r){return}if(!r.$watchers[o]){r.$watchers[o]={}}i.uid=e();r.$watchers[o][i.uid]=i}$unwatch(e,t){let i=e.split("."),n,r=i.pop();n=this.$this;i.forEach(function(e){n=n[e]});if(n.$watchers[r]){if(t){delete n.$watchers[r][t.uid]}else{n.$watchers[r]={}}}}}class o extends r{constructor(e,t,i,n){super(e,t,i,n);this.$observe("length",e.length,n);this.$watch("length",(()=>{this.forEach(((e,t)=>{this.$observe(t,e,n)}))}))}valueOf(){return Array.from(this).map((e=>{return e?e.valueOf():e}))}}Object.getOwnPropertyNames(Array.prototype).forEach((e=>{o.prototype[e]||(o.prototype[e]=Array.prototype[e])}));class c{constructor(t,i){let n=this;this.uid=e();this.object=i;if(typeof t==="function"){t={read:t}}if(t.write){this.writer=function(e,i,n){t.write.call(e,i,n)}}if(t.read){this.reader=function(e){const r=i.$root.$executingComputed;i.$root.$executingComputed=n;let o;try{o=t.read.call(e)}catch(c){o=undefined}i.$root.$executingComputed=r;return o}}}}class s{constructor(e,t){this.name=e;const i=this;let n=function(n){if(t[n]){this[n]=function(r,o,c){const s=c.$root.$executingDirective;c.$root.$executingDirective={element:r,parameters:o,model:c,handler:i,uid:this.getUid(r),name:e};const a=t[n](r,o,c);c.$executingDirective=s;return a}.bind(this)}}.bind(this);n("init");n("bind");n("update")}getUid(t){if(!t.$uid){t.$uid=e()}return`${t.$uid}-${this.name}`}}class a extends r{constructor(e,t){const i=e||{};super(i.data||i,t);this.$templates={};this.$executingComputed=null;this.$executingDirective=null;this.$creatingContext=false;this.$directives={};if(i.computed){Object.keys(i.computed).forEach(function(e){this.$computed[e]=new c(i.computed[e],this);this.$observe(e)}.bind(this))}Object.keys(this.$computed).forEach((e=>{if(this.$computed[e].reader){this[e]=this.$computed[e].reader(this)}else{this[e]=undefined}}))}$apply(e){if(this.$rootElement){throw new n("an emv instance cannot be instanciated on multiple DOM elements.")}this.$rootElement=e||document.body;this.$createContext(this.$rootElement,this);this.$parse(this.$rootElement);this.$render(this.$rootElement)}$clean(e,t){let i=e||this.$rootElement;if(!i){return}if(i.$directives){Object.keys(i.$directives).forEach((e=>{if(!t||t.indexOf(e)===-1){const n=i.$directives[e];delete this.$directives[n];delete i.$directives[e]}}))}if(i.children){Array.from(i.children).forEach((e=>{this.$clean(e)}))}if(i===this.$rootElement){delete this.$rootElement}}$registerTemplate(e,t){const i=t.replace(/<!\-\-(.*?)\-\->/g,"");this.$templates[e]=i}$parse(e,t){const n=new RegExp(i(a.config.delimiters[0])+"(.+?)"+i(a.config.delimiters[1]),"g");if(e.$directives){return}if(e.nodeName.toLowerCase()==="template"){this.$registerTemplate(e.id,e.innerHTML);e.parentNode.removeChild(e)}else if(e.nodeName.toLowerCase()==="#text"){const r=e.textContent;const o=r.match(n);if(o){this.$getContext(e.parentNode);const c=r.replace(n,"' + $1 + '");this.$setElementDirective(e,"text",`'${c}'`)}}else if(e.attributes){Object.keys(a.directives).forEach((i=>{if((!t||t.indexOf(i)===-1)&&e.getAttribute){const n=`${a.config.attributePrefix}-${i}`;if(e.hasAttribute(n)){const r=e.getAttribute(n);const o=a.directives[i];this.$getContext(e);this.$setElementDirective(e,i,r);if(o.init){o.init.call(this,e,r,this)}}}}));Array.from(e.attributes).forEach((t=>{const i=t.name;const r=t.textContent;const o=r.match(n);if(o!==null){let c=this.$directives[e.$directives&&e.$directives.attr];let s=c&&c.parameters||"";if(s){s=s.substring(1,s.length-1)+","}s+=`'${i}' : '${r.replace(n,"' + $1 + '")}'`;s=`{${s}}`;this.$setElementDirective(e,"attr",s)}}))}if(e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$parse(e)}))}}$setElementDirective(t,i,n){if(!t.$directives){t.$directives={}}if(!t.$uid){t.$uid=e()}const r=a.directives[i];const o=r.getUid(t);this.$directives[o]={name:i,handler:r,parameters:n,model:this,element:t};t.$directives[i]=o}$render(e,t){e.$stopRenderingPropagation=false;if(e.$directives){Object.keys(e.$directives).forEach(function(i){if((!t||t.indexOf(i)===-1)&&!e.$stopRenderingPropagation){const n=e.$directives[i];const r=this.$directives[n];if(!r){return}const o=r.handler;const c=r.parameters;if(o.bind){o.bind.call(this,e,c,this)}if(o.update){o.update.call(this,e,c,this)}}}.bind(this))}if(!document.documentElement.contains(e)){return}if(!e.$stopRenderingPropagation&&e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$render(e)}))}}$stopRenderingPropagation(e){e.$stopRenderingPropagation=true}$createContext(e,t,i){this.$creatingContext=true;let o=t;if(t instanceof r){o.$this=t;o.$parent=t.$parent;o.$root=this}else{o={$this:t,$parent:t.$parent,$root:this,$additionalProperties:new Set([])}}let c=this.$getAdditionalContextProperties(e);c.forEach((t=>{if(["$this","$parent","$root"].indexOf(t)!==-1){throw new n(`You cannot apply the key '${t}' as additionnal context property`)}o.$additionalProperties.add(t);o[t]=(e.parentNode||e.$parent).$context[t]}));e.$additionalContextProperties=new Set(c);if(i){Object.keys(i).forEach((t=>{o.$additionalProperties.add(t);o[t]=i[t];e.$additionalContextProperties.add(t)}))}e.$context=o;this.$creatingContext=false}$removeContext(e){delete e.$context;if(e.children){Array.from(e.children).forEach((e=>{this.$removeContext(e)}))}}$getContext(e){if(!e){return{}}if(e.$context){return e.$context}let t=this.$getContext(e.parentNode);e.$context=t;return t}$getAdditionalContextProperties(e){if(e.$additionalContextProperties){return e.$additionalContextProperties}if(e===this.$rootElement){return new Set([])}const t=e.parentNode||e.$parent;if(t){let i=this.$getAdditionalContextProperties(t);e.$additionalContextProperties=i;return i}return new Set([])}$parseDirectiveGetterParameters(e){return new Function("$context",`var $$result;with($context) {$$result=(${e});};return $$result;`)}$getDirectiveValue(e,t,i){const n=e.replace(/\n\s*/g,"");const r=this.$parseDirectiveGetterParameters(n);const o=i||this.$getContext(t);try{return r(o)}catch(c){return undefined}}$parseDirectiveSetterParameters(e){return new Function("$context","$value",`
                with($context) {
                    ${e} = $value;
                }
            `)}$setDirectiveValue(e,t,i){let n=this.$parseDirectiveSetterParameters(e);try{n(this.$getContext(t),i)}catch(r){if(r.name==="ReferenceError"){const o=`$this.${e}`;n(o)}}}static directive(e,t){this.directives[e]=new s(e,t)}$insertRemoveElement(e,t,i,n){const r=i||e;if(t){const o=!r.$parent.contains(e)||n;if(o){let c=null;if(e.$before){e.$before.every(function(e){if(r.$parent.contains(e)){c=e;return false}return true})}if(c){if(c.nextElementSibling){r.$parent.insertBefore(e,c.nextElementSibling)}else{r.$parent.appendChild(e)}}else{r.$parent.insertBefore(e,r.$parent.firstChild)}}}else{this.$stopRenderingPropagation(e);if(r.$parent.contains(e)){r.$parent.removeChild(e)}}}}a.directives={},a.directive("show",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.style.display="":e.style.display="none"}}),a.directive("class",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.originalClassList||(e.originalClassList=[],Array.from(e.classList).forEach(function(t){e.originalClassList.push(t)})),Array.from(e.classList).forEach(function(t){-1===e.originalClassList.indexOf(t)&&e.classList.remove(t)}),n&&("string"==typeof n&&(n={[n]:!0}),"object"==typeof n&&Object.keys(n).forEach(function(t){let i=t.split(" "),r=e.classList;i.forEach(function(e){n[t]?r.add(e):r.remove(e)})}))}}),a.directive("style",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.style[t]=i:e.style[t]=""})}}),a.directive("attr",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.setAttribute(t,i):e.removeAttribute(t)})}}),a.directive("disabled",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.setAttribute("disabled",!0):e.removeAttribute("disabled")}}),a.directive("value",{bind:function(e,t,i){e["true"===e.contentEditable?"onblur":"onchange"]=function(){let n,r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":n=Boolean(e.checked);break;case"radio":n=document.querySelector(`input[name="${e.name}"]:checked`).value;break;default:n=e.value}break;case"textarea":n=e.value;break;default:if(e.contentEditable){n=e.innerHTML;break}return}i.$setDirectiveValue(t,e,n)}},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);void 0===n&&(n="");let r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":e.checked=Boolean(n);break;case"radio":let c=document.querySelector(`input[name="${e.name}"][value="${n}"]`);c&&(c.checked=!0);break;case"file":return;default:e.value=n}break;case"textarea":e.value=n;break;default:e.contentEditable?e.innerHTML=n:e.value=n}}}),a.directive("input",{bind:function(e,t,i){e.addEventListener("input",function(){i.$setDirectiveValue(t,e,e.value)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.value=n||""}}),a.directive("focus",{bind:function(e,t,i){e.addEventListener("focus",function(){i.$setDirectiveValue(t,e,!0)}),e.addEventListener("blur",function(){i.$setDirectiveValue(t,e,!1)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&e!==document.activeElement?e.focus():n||e!==document.activeElement||e.blur()}}),a.directive("options",{update:function(e,t,i){if("select"!==e.nodeName.toLowerCase())throw new n("options directive can be applied only on select tags");let r=i.$getDirectiveValue(t,e),o=r.valueOf();if(r&&(!("$data"in r)||r.$data)){if(r.$data){o={};const c=r.$data.valueOf();Object.keys(c).forEach(function(e){let t=r.$data[e],i=r.$value?t[r.$value]:e,n=r.$label?t[r.$label]:t;o[i]=n})}let s=e.value||r.$selected;e.innerHTML="";let a=function(t,i){let n=document.createElement("option");n.value=t,n.innerText=i,t.toString()===s&&(n.selected=!0),e.appendChild(n)};Object.keys(o).forEach(function(e){let t=o[e];a(e,t)})}}}),a.directive("text",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);"#text"===e.nodeName?e.nodeValue=n:e.innerText=n}}),a.directive("html",{update:function(e,t,i){const n=i.$getDirectiveValue(t,e);e.innerHTML=n;const r=e.querySelectorAll("script");Array.from(r).forEach((e=>{if(e.innerText){const t=new Function(e.innerText);t()}else{const i=document.createElement("script");i.src=e.src,e.parentNode.replaceChild(i,e)}}))}}),a.directive("click",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t);e.onclick=function(t){let r=i.$getContext(e),o=n(r,t);"function"==typeof o&&o.call(r.$this,r,t)}}}),a.directive("on",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t),r=n(i.$getContext(e));"object"==typeof r&&Object.keys(r).forEach(function(t){let n=r[t],o=`on${t}`;e[o]=function(t){n(i.$getContext(e),t)}})}}),a.directive("submit",{bind:function(e,t,i){if("form"!==e.nodeName.toLowerCase())throw new n("submit directive can be applied only on form tags");let r=i.$parseDirectiveGetterParameters(t);e.addEventListener("submit",function(t){let n=r(i.$getContext(e));"function"==typeof n&&n(i.$getContext(e),t)})}});const u=function(t,i){t.$before=[],t.previousElementSibling&&(t.$before=[t.previousElementSibling],t.previousElementSibling.$before&&(t.$before=t.$before.concat(t.previousElementSibling.$before))),t.$parent=t.parentNode;const n=t.innerHTML,r=e();t.$templateName=r,i.$registerTemplate(r,n)};a.directive("each",{init:function(e,t,i){u(e,i),e.$clones=[];const n=document.createElement("meta");n.$initialElement=e,n.$uid=e.$uid,n.$context=e.$context,n.setAttribute("name",`e-each-${e.$uid}`),i.$setElementDirective(n,"each",t),e.parentNode.replaceChild(n,e)},update:function(e,t,i){const n=e.$initialElement,r=i.$getDirectiveValue(t,n);if(r){let o=r&&Array.from("$data"in r?r.$data||[]:r)||[];o=o.filter((e=>void 0!==e&&null!==e)),r.$filter&&(o=o.filter(r.$filter)),r.$sort&&("function"==typeof r.$sort?o.sort(r.$sort):o.sort(function(e,t){return e[r.$sort]<t[r.$sort]?-1:1})),r.$order&&r.$order<0&&o.reverse();let c=r.$offset||0,s=c+(r.$limit||o.length);o=o.slice(c,s);let a=n.$clones.slice();a.forEach((e=>{-1!==o.indexOf(e.$$item)&&e.$context||(i.$clean(e),e.parentNode&&e.parentNode.contains(e)&&e.parentNode.removeChild(e))})),n.$clones=[],o.forEach(function(t,o){const c=a.findIndex((e=>{return e.$$item===t})),s=n.$clones.slice().reverse().concat(e).concat(n.$before);if(-1!==c){let u=a[c];if(n.$clones.push(u),c===o)return;return u.$before=s,u.$context.$index=o,void i.$insertRemoveElement(u,!0,n,!0)}let f={$index:o};r.$item&&(f[r.$item]=t);const d=n.cloneNode(!0);d.$$item=t,d.$parent=n.$parent,i.$createContext(d,t,f),d.$before=s,Object.keys(n.$directives).forEach((e=>{if("each"!==e){const t=n.$directives[e];i.$setElementDirective(d,e,i.$directives[t].parameters)}})),i.$insertRemoveElement(d,!0,n),d.innerHTML=i.$templates[n.$templateName],d.childNodes&&Array.from(d.childNodes).forEach((e=>{i.$parse(e)})),i.$render(d,["each"]),n.$clones.push(d)})}}}),a.directive("if",{init:function(e,t,i){u(e,i)},update:function(e,t,i){let n=Boolean(i.$getDirectiveValue(t,e));i.$insertRemoveElement(e,n),n&&i.$render(e,["if"])}}),a.directive("unless",{init:function(e,t,i){u(e,i)},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);i.$insertRemoveElement(e,!n),n||i.$render(e,["unless"])}}),a.directive("with",{init:function(e,t,i){u(e,i)},update:function(e,t,i){let n,r={};if(e===i.$rootElement)n=i.$getDirectiveValue(t,e,i);else{if(!e.$parent)return void i.$stopRenderingPropagation(e);i.$removeContext(e),n=i.$getDirectiveValue(t,e.$parent)}n&&"$data"in n&&("$as"in n&&(r[n.$as]=n.$data),n=n.$data),n?(i.$removeContext(e),i.$createContext(e,n,r),i.$insertRemoveElement(e,!0),e.childNodes&&Array.from(e.childNodes).forEach((e=>{i.$clean(e)})),e.innerHTML=i.$templates[e.$templateName],e.childNodes&&Array.from(e.childNodes).forEach((e=>{i.$parse(e)})),i.$render(e,["with"])):i.$insertRemoveElement(e,!1)}}),a.directive("template",{update:function(e,t,i){if(document.documentElement.contains(e)){let n=i.$getDirectiveValue(t,e),r=i.$templates[n]||"";e.innerHTML=r;const o=e.querySelectorAll("script");Array.from(o).forEach((e=>{if(e.innerText){const t=new Function(e.innerText);t()}else{const i=document.createElement("script");i.src=e.src,e.parentNode.replaceChild(i,e)}})),e.childNodes&&(Array.from(e.childNodes).forEach((e=>{i.$parse(e)})),Array.from(e.childNodes).forEach((e=>{i.$render(e)})))}}}),a.config={attributePrefix:"e",delimiters:["${","}"]},Object.defineProperty(a,"version",{value:"2.0.0-2",writable:!1}),a.utils={uid:function(){return e()}};const f=Array.isArray;Array.isArray=function(e){return e instanceof o?!0:f(e)};const d=Object.keys;return Object.keys=function(e){if(e instanceof o){const t=[];return e.forEach(((e,i)=>{t.push(i.toString())})),t}if(e instanceof r){const t=d(e);return t.filter((t=>{return"$"!==t.substr(0,1)&&!(e.$additionalProperties&&e.$additionalProperties.has(t))}))}return d(e)},a});