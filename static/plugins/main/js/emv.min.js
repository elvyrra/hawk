/**
 * emv.js 3.0.0
 *
 * @author Elvyrra S.A.S
 * @license http://rem.mit-license.org/ MIT
 */
"use strict";!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EMV=t()}(this,function(){function e(){const e=()=>{return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e){let t=["string","number","boolean","undefined","symbol"];return t.indexOf(typeof e)!==-1||null===e}function i(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}class n extends Error{constructor(e){let t=`EMV Error : ${e}`;super(t)}}class r{constructor(e,t,i,n){this.$computed={},this.$observed=new Set([]),this.$callers={},this.$watchers={},this.$root=t||this,this.$parent=i,this.$this=this,this.$directives={},this.$object=e,this.$additionalProperties=new Set([]),Object.keys(e).forEach(t=>{this.$observe(t,e[t],n)}),"Object"!==e.constructor.name&&Object.getOwnPropertyNames(e.constructor.prototype).forEach(t=>{this.constructor.prototype[t]||(this.constructor.prototype[t]=e.constructor.prototype[t])})}$observe(e,i,n){if(!this.$observed.has(e)){const c={get:()=>{let t=this.$object[e];if(this.$root&&"function"!=typeof t){if(this.$root.$executingComputed&&(this.$callers[e]||(this.$callers[e]={}),!this.$callers[e][this.$root.$executingComputed.uid])){const t=this.$root.$executingComputed,i=t.object;Object.keys(i.$computed).every(n=>{return i.$computed[n]!==t||(this.$callers[e][t.uid]={property:n,reader:t.reader,writer:t.writer,object:t.object},!1)})}this.$root.$executingDirective&&(this.$directives[e]||(this.$directives[e]=new Set([])),this.$directives[e].add(this.$root.$executingDirective.uid))}return t},set:i=>{let c=!1;if(e in this.$object||this.$root.$creatingContext||(c=!0),"function"==typeof i||i instanceof HTMLElement)return this.$object[e]=i,!0;let s=this.$object[e];if(t(i)||i instanceof r?(this.$object[e]=i,i instanceof a&&(i.$setRoot(this.$root||this),i.$parent=this)):Array.isArray(i)?this.$object[e]=new o(i,this.$root||this,this,e):this.$object[e]=new r(i,this.$root||this,this,e),this.$computed[e]&&this.$computed[e].writer)try{this.$computed[e].writer(this,i,s)}catch(e){}return s!==i&&(this.$notifySubscribers(e,i,s),c&&this.$parent&&this.$parent.$notifySubscribers(n,this.$parent)),!0},enumerable:!0,configurable:!0};Object.defineProperty(this,e,c),this.$observed.add(e),this[e]=i}}$setRoot(e){this.$root=e,Object.keys(this.$object).forEach(t=>{this.$object[t]instanceof r&&this.$object[t].$setRoot(e)})}$notifySubscribers(e,t,i){e&&(void 0===t&&(t=this[e]),this.$callers[e]&&Object.keys(this.$callers[e]).forEach(t=>{const i=this.$callers[e][t];i.object[i.property]=i.reader(i.object)}),this.$watchers[e]&&Object.keys(this.$watchers[e]).forEach(n=>{this.$watchers[e][n].call(this,t,i)}),this.$directives[e]&&this.$directives[e].forEach(t=>{const i=this.$root.$directives[t];return i?void(i&&i.handler.update&&i.handler.update(i.element,i.parameters,i.model)):void this.$directives[e].delete(t)}))}valueOf(){let e={};return Object.keys(this).forEach(t=>{e[t]=this[t]?this[t].valueOf():this[t]}),e}toString(){return JSON.stringify(this.valueOf())}$watch(t,i){if(Array.isArray(t))return void t.forEach(e=>{this.$watch(e,i)});let n,r=t.split("."),o=r.pop();n=this.$this,r.forEach(e=>{n=n[e]}),n&&(n.$watchers[o]||(n.$watchers[o]={}),i.uid=e(),n.$watchers[o][i.uid]=i)}$unwatch(e,t){let i,n=e.split("."),r=n.pop();i=this.$this,n.forEach(e=>{i=i[e]}),i.$watchers[r]&&(t?delete i.$watchers[r][t.uid]:i.$watchers[r]={})}}class o extends r{constructor(e,t,i,n){super(e,t,i,n),this.$observe("length",e.length,n),this.$watch("length",()=>{this.forEach((e,t)=>{this.$observe(t,e,n)})})}valueOf(){return Array.from(this).map(e=>{return e?e.valueOf():e})}}Object.getOwnPropertyNames(Array.prototype).forEach(e=>{o.prototype[e]||(o.prototype[e]=Array.prototype[e])});class c{constructor(t,i){let n=this;this.uid=e(),this.object=i,"function"==typeof t&&(t={read:t}),t.write&&(this.writer=function(e,i,n){t.write.call(e,i,n)}),t.read&&(this.reader=function(e){const r=i.$root.$executingComputed;i.$root.$executingComputed=n;let o;try{o=t.read.call(e)}catch(e){o=void 0}return i.$root.$executingComputed=r,o})}}class s{constructor(e,t){this.name=e;const i=this;let n=n=>{t[n]&&(this[n]=((r,o,c)=>{const s=c.$root.$executingDirective;c.$root.$executingDirective={element:r,parameters:o,model:c,handler:i,uid:this.getUid(r),name:e};const a=t[n](r,o,c);return c.$executingDirective=s,a}))};n("init"),n("bind"),n("update")}getUid(t){return t.$uid||(t.$uid=e()),`${t.$uid}-${this.name}`}}class a extends r{constructor(e,t){const i=e||{};super(i.data||i,t),this.$templates={},this.$executingComputed=null,this.$executingDirective=null,this.$creatingContext=!1,this.$directives={},i.computed&&Object.keys(i.computed).forEach(e=>{this.$computed[e]=new c(i.computed[e],this),this.$observe(e)}),Object.keys(this.$computed).forEach(e=>{this.$computed[e].reader?this[e]=this.$computed[e].reader(this):this[e]=void 0})}$apply(e){if(this.$rootElement)throw new n("an emv instance cannot be instanciated on multiple DOM elements.");this.$rootElement=e||document.body,this.$createContext(this.$rootElement,this),this.$parse(this.$rootElement),this.$render(this.$rootElement)}$clean(e,t){let i=e||this.$rootElement;i&&(i.$directives&&Object.keys(i.$directives).forEach(e=>{if(!t||t.indexOf(e)===-1){const t=i.$directives[e];delete this.$directives[t],delete i.$directives[e]}}),i.children&&Array.from(i.children).forEach(e=>{this.$clean(e)}),i===this.$rootElement&&delete this.$rootElement)}$registerTemplate(e,t){const i=t.replace(/<!\-\-(.*?)\-\->/g,"");this.$templates[e]=i}$parseDirectiveTransformation(e){const t=/^(\w+)(\((.+)\))?$/.exec(e);if(t){const e=t[1],i=`{${t[3]||""}}`;return{name:e,parameters:i}}throw new Error}$parseHandlebardDirective(e,t){const r=new RegExp(i(a.config.delimiters[0])+"(.+?)"+i(a.config.delimiters[1]),"g"),o=t.match(r);if(o){this.$getContext(e.parentNode);const i=t.replace(r,(e,i)=>{var r=i.split("::").map(e=>{return e.trim()});let o=r[0];return r.length>1&&r.slice(1).forEach(e=>{try{const i=this.$parseDirectiveTransformation(e);o=`EMV.transformations.${i.name}(${o}, ${i.parameters})`}catch(e){throw new n(`Error while parsing directive transformation : ${t}`)}}),`' + ${o} + '`});return i}return null}$parse(e,t){if(!e.$directives){if("template"===e.nodeName.toLowerCase())this.$registerTemplate(e.id,e.innerHTML),e.parentNode.removeChild(e);else if("#text"===e.nodeName.toLowerCase()){const t=this.$parseHandlebardDirective(e,e.textContent);null!==t&&this.$setElementDirective(e,"text",`'${t}'`)}else e.attributes&&(Object.keys(a.directives).forEach(i=>{if((!t||t.indexOf(i)===-1)&&e.getAttribute){const t=`${a.config.attributePrefix}-${i}`;if(e.hasAttribute(t)){const n=e.getAttribute(t),r=a.directives[i];this.$getContext(e),this.$setElementDirective(e,i,n),r.init&&r.init.call(this,e,n,this)}}}),Array.from(e.attributes).forEach(t=>{const i=t.name,n=t.textContent,r=this.$parseHandlebardDirective(e,n);if(null!==r){let t=this.$directives[e.$directives&&e.$directives.attr],n=t&&t.parameters||"";n&&(n=n.substring(1,n.length-1)+","),n+=`'${i}' : '${r}'`,n=`{${n}}`,this.$setElementDirective(e,"attr",n)}}));e.childNodes&&Array.from(e.childNodes).forEach(e=>{this.$parse(e)})}}$setElementDirective(t,i,n){t.$directives||(t.$directives={}),t.$uid||(t.$uid=e());const r=a.directives[i],o=r.getUid(t);this.$directives[o]={name:i,handler:r,parameters:n,model:this,element:t},t.$directives[i]=o}$render(e,t){e.$stopRenderingPropagation=!1,e.$directives&&Object.keys(e.$directives).forEach(function(i){if(!(t&&t.indexOf(i)!==-1||e.$stopRenderingPropagation)){const t=e.$directives[i],n=this.$directives[t];if(!n)return;const r=n.handler,o=n.parameters;r.bind&&r.bind.call(this,e,o,this),r.update&&r.update.call(this,e,o,this)}}.bind(this)),document.documentElement.contains(e)&&!e.$stopRenderingPropagation&&e.childNodes&&Array.from(e.childNodes).forEach(e=>{this.$render(e)})}$stopRenderingPropagation(e){e.$stopRenderingPropagation=!0}$createContext(e,t,i){this.$creatingContext=!0;let o=t;t instanceof r?(o.$this=t,o.$parent=t.$parent,o.$root=this):o={$this:t,$parent:t.$parent,$root:this,$additionalProperties:new Set([])};let c=this.$getAdditionalContextProperties(e);c.forEach(t=>{if(["$this","$parent","$root"].indexOf(t)!==-1)throw new n(`You cannot apply the key '${t}' as additionnal context property`);o.$additionalProperties.add(t),o[t]=(e.parentNode||e.$parent).$context[t]}),e.$additionalContextProperties=new Set(c),i&&Object.keys(i).forEach(t=>{o.$additionalProperties.add(t),o[t]=i[t],e.$additionalContextProperties.add(t)}),e.$context=o,this.$creatingContext=!1}$removeContext(e){delete e.$context,e.children&&Array.from(e.children).forEach(e=>{this.$removeContext(e)})}$getContext(e){if(!e)return{};if(e.$context)return e.$context;let t=this.$getContext(e.parentNode);return e.$context=t,t}$getAdditionalContextProperties(e){if(e.$additionalContextProperties)return e.$additionalContextProperties;if(e===this.$rootElement)return new Set([]);const t=e.parentNode||e.$parent;if(t){let i=this.$getAdditionalContextProperties(t);return e.$additionalContextProperties=i,i}return new Set([])}$parseDirectiveGetterParameters(e){return new Function("$context",`var $$result;with($context) {$$result=(${e});};return $$result;`)}$getDirectiveValue(e,t,i){const n=e.replace(/\n\s*/g,""),r=this.$parseDirectiveGetterParameters(n),o=i||this.$getContext(t);try{const e=r(o);if("object"==typeof e&&e.$transform&&"$data"in e){Array.isArray(e.$transform)||(e.$transform=[e.$transform]);let t=e.$data;return e.$transform.forEach(e=>{const i=this.$parseDirectiveTransformation(e),n=new Function("",`return ${i.parameters};`);t=a.transformations[i.name](t,n())}),t}return e}catch(e){return}}$parseDirectiveSetterParameters(e){return new Function("$context","$value",`
                with($context) {
                    ${e} = $value;
                }
            `)}$setDirectiveValue(e,t,i){let r=this.$parseDirectiveSetterParameters(e);try{r(this.$getContext(t),i)}catch(e){throw new n(e.message)}}static directive(e,t){this.directives[e]=new s(e,t)}static transform(e,t){this.transformations[e]=t}$insertRemoveElement(e,t,i,n){const r=i||e;if(t){const t=!r.$parent.contains(e)||n;if(t){let t=null;e.$before&&e.$before.every(function(e){return!r.$parent.contains(e)||(t=e,!1)}),t?t.nextElementSibling?r.$parent.insertBefore(e,t.nextElementSibling):r.$parent.appendChild(e):r.$parent.insertBefore(e,r.$parent.firstChild)}}else this.$stopRenderingPropagation(e),r.$parent.contains(e)&&r.$parent.removeChild(e)}}a.directives={},a.directive("show",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.style.display="":e.style.display="none"}}),a.directive("class",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.originalClassList||(e.originalClassList=[],Array.from(e.classList).forEach(function(t){e.originalClassList.push(t)})),Array.from(e.classList).forEach(function(t){e.originalClassList.indexOf(t)===-1&&e.classList.remove(t)}),n&&("string"==typeof n&&(n={[n]:!0}),"object"==typeof n&&Object.keys(n).forEach(function(t){let i=t.split(" "),r=e.classList;i.forEach(function(e){n[t]?r.add(e):r.remove(e)})}))}}),a.directive("style",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.style[t]=i:e.style[t]=""})}}),a.directive("attr",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.setAttribute(t,i):e.removeAttribute(t)})}}),a.directive("disabled",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.setAttribute("disabled",!0):e.removeAttribute("disabled")}}),a.directive("value",{bind:function(e,t,i){e["true"===e.contentEditable?"onblur":"onchange"]=function(){let n,r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":n=Boolean(e.checked);break;case"radio":n=document.querySelector(`input[name="${e.name}"]:checked`).value;break;default:n=e.value}break;case"textarea":n=e.value;break;default:if(e.contentEditable){n=e.innerHTML;break}return}i.$setDirectiveValue(t,e,n)}},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);void 0===n&&(n="");let r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":e.checked=Boolean(n);break;case"radio":{let t=document.querySelector(`input[name="${e.name}"][value="${n}"]`);t&&(t.checked=!0);break}case"file":return;default:e.value=n}break;case"textarea":e.value=n;break;default:e.contentEditable?e.innerHTML=n:e.value=n}}}),a.directive("input",{bind:function(e,t,i){e.addEventListener("input",function(){i.$setDirectiveValue(t,e,e.value)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.value=n||""}}),a.directive("focus",{bind:function(e,t,i){e.addEventListener("focus",function(){i.$setDirectiveValue(t,e,!0)}),e.addEventListener("blur",function(){i.$setDirectiveValue(t,e,!1)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&e!==document.activeElement?e.focus():n||e!==document.activeElement||e.blur()}}),a.directive("options",{update:function(e,t,i){if("select"!==e.nodeName.toLowerCase())throw new n("options directive can be applied only on select tags");let r=i.$getDirectiveValue(t,e),o=r.valueOf();if(r&&(!("$data"in r)||r.$data)){if(r.$data){o={};const e=r.$data.valueOf();Object.keys(e).forEach(function(e){let t=r.$data[e],i=r.$value?t[r.$value]:e,n=r.$label?t[r.$label]:t;o[i]=n})}let t=e.value||r.$selected;e.innerHTML="";let i=function(i,n){let r=document.createElement("option");r.value=i,r.innerText=n,i.toString()===t&&(r.selected=!0),e.appendChild(r)};Object.keys(o).forEach(function(e){let t=o[e];i(e,t)})}}}),a.directive("text",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);"#text"===e.nodeName?e.nodeValue=n:e.innerText=n}}),a.directive("html",{update:function(e,t,i){const n=i.$getDirectiveValue(t,e);e.innerHTML=n;const r=e.querySelectorAll("script");Array.from(r).forEach(e=>{if(e.innerText){const t=new Function(e.innerText);t()}else{const t=document.createElement("script");t.src=e.src,e.parentNode.replaceChild(t,e)}})}}),a.directive("click",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t);e.onclick=function(t){let r=i.$getContext(e),o=n(r,t);"function"==typeof o&&o.call(r.$this,r,t)}}}),a.directive("on",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t),r=n(i.$getContext(e));"object"==typeof r&&Object.keys(r).forEach(function(t){let n=r[t],o=`on${t}`;e[o]=function(t){n(i.$getContext(e),t)}})}}),a.directive("submit",{bind:function(e,t,i){if("form"!==e.nodeName.toLowerCase())throw new n("submit directive can be applied only on form tags");let r=i.$parseDirectiveGetterParameters(t);e.addEventListener("submit",function(t){let n=r(i.$getContext(e));"function"==typeof n&&n(i.$getContext(e),t)})}});const u=function(t,i){t.$before=[],t.previousElementSibling&&(t.$before=[t.previousElementSibling],t.previousElementSibling.$before&&(t.$before=t.$before.concat(t.previousElementSibling.$before))),t.$parent=t.parentNode;const n=t.innerHTML,r=e();t.$templateName=r,i.$registerTemplate(r,n)};a.directive("each",{init:function(e,t,i){u(e,i),e.$clones=[];const n=document.createElement("meta");n.$initialElement=e,n.$uid=e.$uid,n.$context=e.$context,n.setAttribute("name",`e-each-${e.$uid}`),i.$setElementDirective(n,"each",t),e.parentNode.replaceChild(n,e)},update:function(e,t,i){const n=e.$initialElement,r=i.$getDirectiveValue(t,n);if(r){let t=r&&Array.from("$data"in r?r.$data||[]:r)||[];t=t.filter(e=>void 0!==e&&null!==e),r.$filter&&(t=t.filter(r.$filter)),r.$sort&&("function"==typeof r.$sort?t.sort(r.$sort):t.sort(function(e,t){return e[r.$sort]<t[r.$sort]?-1:1})),r.$order&&r.$order<0&&t.reverse();let o=r.$offset||0,c=o+(r.$limit||t.length);t=t.slice(o,c);let s=n.$clones.slice();s.forEach(e=>{t.indexOf(e.$$item)!==-1&&e.$context||(i.$clean(e),e.parentNode&&e.parentNode.contains(e)&&e.parentNode.removeChild(e))}),n.$clones=[],t.forEach(function(t,o){const c=s.findIndex(e=>{return e.$$item===t}),a=n.$clones.slice().reverse().concat(e).concat(n.$before);if(c!==-1){let e=s[c];if(n.$clones.push(e),c===o)return;return e.$before=a,e.$context.$index=o,void i.$insertRemoveElement(e,!0,n,!0)}let u={$index:o};r.$item&&(u[r.$item]=t);const d=n.cloneNode(!0);d.$$item=t,d.$parent=n.$parent,i.$createContext(d,t,u),d.$before=a,Object.keys(n.$directives).forEach(e=>{if("each"!==e){const t=n.$directives[e];i.$setElementDirective(d,e,i.$directives[t].parameters)}}),i.$insertRemoveElement(d,!0,n),d.innerHTML=i.$templates[n.$templateName],d.childNodes&&Array.from(d.childNodes).forEach(e=>{i.$parse(e)}),i.$render(d,["each"]),n.$clones.push(d)})}}}),a.directive("if",{init:function(e,t,i){u(e,i)},update:function(e,t,i){let n=Boolean(i.$getDirectiveValue(t,e));i.$insertRemoveElement(e,n),n&&i.$render(e,["if"])}}),a.directive("unless",{init:function(e,t,i){u(e,i)},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);i.$insertRemoveElement(e,!n),n||i.$render(e,["unless"])}}),a.directive("with",{init:function(e,t,i){u(e,i)},update:function(e,t,i){let n,r={};if(e===i.$rootElement)n=i.$getDirectiveValue(t,e,i);else{if(!e.$parent)return void i.$stopRenderingPropagation(e);i.$removeContext(e),n=i.$getDirectiveValue(t,e.$parent)}n&&"$data"in n&&("$as"in n&&(r[n.$as]=n.$data),n=n.$data),n?(i.$removeContext(e),i.$createContext(e,n,r),i.$insertRemoveElement(e,!0),e.childNodes&&Array.from(e.childNodes).forEach(e=>{i.$clean(e)}),e.innerHTML=i.$templates[e.$templateName],e.childNodes&&Array.from(e.childNodes).forEach(e=>{i.$parse(e)}),i.$render(e,["with"])):i.$insertRemoveElement(e,!1)}}),a.directive("template",{update:function(e,t,i){if(document.documentElement.contains(e)){let n=i.$getDirectiveValue(t,e),r=i.$templates[n]||"";e.innerHTML=r;const o=e.querySelectorAll("script");Array.from(o).forEach(e=>{if(e.innerText){const t=new Function(e.innerText);t()}else{const t=document.createElement("script");t.src=e.src,e.parentNode.replaceChild(t,e)}}),e.childNodes&&(Array.from(e.childNodes).forEach(e=>{i.$parse(e)}),Array.from(e.childNodes).forEach(e=>{i.$render(e)}))}}}),a.transformations={},a.transform("upper",e=>{return"string"==typeof e&&e.toUpperCase()||e}),a.transform("lower",e=>{return"string"==typeof e&&e.toLowerCase()||e}),a.transform("ucfirst",e=>{return"string"!=typeof e?e:e.substr(0,1).toUpperCase()+e.substr(1)}),a.transform("ucwords",e=>{return"string"!=typeof e?e:e.replace(/(^|\s)(.)/g,(e,t,i)=>{return t+i.toUpperCase()})}),a.transform("json",e=>{return JSON.stringify(e.valueOf())}),a.transform("number",(e,t)=>{if("number"!=typeof e)return e;let i=e;return void 0!==t.decimals&&(i=i.toFixed(t.decimals)),t.thousandSep&&(i=i.replace(/\B(?=(?:\d{3})+(?!\d))/g,t.thousandSep)),t.decimalSep&&(i=i.replace(".",t.decimalSep)),i}),a.config={attributePrefix:"e",delimiters:["${","}"]},Object.defineProperty(a,"version",{value:"3.0.0",writable:!1}),a.utils={uid:function(){return e()}};const d=Array.isArray;Array.isArray=function(e){return e instanceof o||d(e)};const f=Object.keys;return Object.keys=function(e){if(e instanceof o){const t=[];return e.forEach((e,i)=>{t.push(i.toString())}),t}if(e instanceof r){const t=f(e);return t.filter(t=>{return"$"!==t.substr(0,1)&&!(e.$additionalProperties&&e.$additionalProperties.has(t))})}return f(e)},a});