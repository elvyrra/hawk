/**
 * emv.js v1.0.4
 *
 * @author Elvyrra S.A.S
 * @license http://rem.mit-license.org/ MIT
 */
"use strict";!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EMV=t()}(this,function(){function e(){const e=()=>{return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e){let t=["string","number","boolean","undefined","symbol"];return-1!==t.indexOf(typeof e)||null===e}function i(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}let n=null,r=null,o=!1;const c=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","if","in","instanceof","new","return","switch","throw","try","typeof","var","void","while","with","class","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield"],s=new RegExp(`\\b(${c.join("|")})\\b`,"g");class a extends Error{constructor(e){let t=`EMV Error : ${e}`;super(t)}}class f{constructor(e,i,c,s){this.$callers={};this.$directives={};this.$watchers={};this.$root=i||this;this.$parent=c;this.$computed={};this.$this=this;let a={get:function(e,t){if(typeof t!=="string"){return e[t]}let i=e[t];if(t.substr(0,1)==="$"){return this[t]}if(this.$root&&typeof i!=="function"){if(n){if(!this.$callers[t]){this.$callers[t]={}}if(!this.$callers[t][n.uid]){Object.keys(this.$root.$computed).every(function(e){if(this.$root.$computed[e]===n){this.$callers[t][n.uid]={property:e,reader:n.reader,writer:n.writer,object:n.object};return false}return true}.bind(this))}}if(r){if(!this.$directives[t]){this.$directives[t]={}}if(!this.$directives[t][r.uid]){this.$directives[t][r.uid]=r}}}return i}.bind(this),set:function(e,i,n){if(typeof i!=="string"){return true}let r=false;let c=i.substr(0,1)==="$";if(!(i in e)&&!o){r=true}if(c||typeof n==="function"){e[i]=n;return true}let a=e[i];if(!t(n)&&!(n instanceof f)){if(Array.isArray(n)){e[i]=new u(n,this.$root||e,e,i)}else{e[i]=new f(n,this.$root||e,e,i)}}else{e[i]=n;if(n instanceof $){n.$root=this.$root||e;n.$parent=e}}if(this.$computed[i]&&this.$computed[i].writer){try{this.$computed[i].writer(this,n,a)}catch(d){}}if(a!==n){this.$notifySubscribers(i,n,a);if(r&&this.$parent){this.$parent.$notifySubscribers(s,this.$parent)}}return true}.bind(this),deleteProperty:function(e,t){if(typeof t!=="string"){return true}let i=t.substr(0,1)==="$";let n=e[t];delete e[t];if(!i){this.$notifySubscribers(t,undefined,n);if(this.$parent){this.$parent.$notifySubscribers(s,this.$parent)}}return true}.bind(this),ownKeys:function(e){return Object.getOwnPropertyNames(e).filter(function(e){return e.substr(0,1)!=="$"&&(!this instanceof u||e!=="length")})}};let d=new Proxy(this,a);Object.keys(e).forEach(function(t){d[t]=e[t]});return d}$notifySubscribers(e,t,i){if(!e){Object.keys(this).forEach((e=>{this.$notifySubscribers(e)}));return}if(t===undefined){t=this[e]}if(this.$callers[e]){Object.keys(this.$callers[e]).forEach(function(t){const i=this.$callers[e][t];i.object[i.property]=i.reader(i.object)}.bind(this))}if(this.$watchers[e]){Object.keys(this.$watchers[e]).forEach(function(n){this.$watchers[e][n].call(this,t,i)}.bind(this))}if(this.$directives[e]){Object.keys(this.$directives[e]).forEach(function(t){const i=this.$directives[e][t];if(i.handler.update){i.handler.update(i.element,i.parameters,i.model,i.context)}}.bind(this))}}$cleanDirectives(e){if(e.$directives){Object.keys(e.$directives).forEach((t=>{Object.keys(this.$directives).forEach((i=>{let n=e.$uid+t;delete this.$directives[i][n]}));delete e.$directives[t]}))}Object.keys(this).forEach((t=>{if(this[t]instanceof f){this[t].$cleanDirectives(e)}}))}valueOf(){let e={};Object.keys(this).forEach((t=>{e[t]=this[t]?this[t].valueOf():this[t]}));return e}toString(){return JSON.stringify(this.valueOf())}}class u extends f{constructor(e,t,i,n){super(e,t,i,n);this.length=e.length}valueOf(){return Array.from(this).map((e=>{return e?e.valueOf():e}))}}Object.getOwnPropertyNames(Array.prototype).forEach((e=>{"constructor"!==e&&(u.prototype[e]=Array.prototype[e])}));class d{constructor(t,i){let r=this;this.uid=e();this.object=i;if(typeof t==="function"){t={read:t}}if(t.write){this.writer=function(e,i,n){t.write.call(e,i,n)}}if(t.read){this.reader=function(e){const i=n;n=r;let o;try{o=t.read.call(e)}catch(c){o=undefined}n=i;return o}}}}class l{constructor(t,i){this.name=t;const n=this;let o=function(o){if(i[o]){this[o]=function(c,s,a,f){if(!c.$uid){c.$uid=e()}r={element:c,parameters:s,model:a,context:f,handler:n,uid:c.$uid+t,name:t};i[o](c,s,a,f);r=null}}}.bind(this);o("init");o("bind");o("update")}}class $ extends f{constructor(e){super(e.data);this.$templates={};if(e.computed){Object.keys(e.computed).forEach(function(t){this.$computed[t]=new d(e.computed[t],this)}.bind(this))}Object.keys(this.$computed).forEach((e=>{if(this.$computed[e].reader){this[e]=this.$computed[e].reader(this)}else{this[e]=undefined}}))}$watch(t,i){if(Array.isArray(t)){t.forEach((e=>{this.$watch(e,i)}));return}let n=t.split("."),r,o=n.pop();r=this.$this;n.forEach(function(e){r=r[e]});if(!r){return}if(!r.$watchers[o]){r.$watchers[o]={}}i.uid=e();r.$watchers[o][i.uid]=i}$unwatch(e,t){let i=e.split("."),n,r=i.pop();n=this.$this;i.forEach(function(e){n=n[e]});if(n.$watchers[r]){if(t){delete n.$watchers[r][t.uid]}else{n.$watchers[r]={}}}}$apply(e){if(this.$rootElement){throw new a("an emv instance cannot be instanciated on multiple DOM elements.")}this.$rootElement=e||document.body;this.$createContext(this.$rootElement,this);this.$parse(this.$rootElement);this.$render(this.$rootElement)}$clean(e){let t=e||this.$rootElement;if(!t){return}this.$cleanDirectives(t);delete t.$directives;if(t.children){Array.from(t.children).forEach((e=>{this.$clean(e)}))}delete this.$rootElement}$registerTemplate(e,t){this.$templates[e]=t}$parse(e,t){const n=new RegExp(i($.config.delimiters[0])+"(.+?)"+i($.config.delimiters[1]),"g");const r=new RegExp(i($.config.htmlDelimiters[0])+"(.+?)"+i($.config.htmlDelimiters[1]),"g");if(e.nodeName.toLowerCase()==="template"){this.$registerTemplate(e.id,e.innerHTML)}else if(e.nodeName.toLowerCase()==="#text"){const o=e.textContent;const c=o.match(n);const s=o.match(r);if(c||s){this.$getContext(e.parentNode);if(!e.parentNode.$directives){e.parentNode.$directives={}}if(s||e.nextElementSibling||e.previousElementSibling){const a=e.parentNode.innerHTML.replace(n,"' + ($1) + '").replace(r,"' + ($1) + '").replace(/^\s+/,"").replace(/\s+$/,"");e.parentNode.$directives.html={name:"html",handler:$.directives.html,parameters:`'${a}'`}}else{const a=o.replace(n,"' + ($1) + '").replace(r,"' + ($1) + '").replace(/^\s+/,"").replace(/\s+$/,"");e.parentNode.$directives.text={name:"text",handler:$.directives.text,parameters:`'${a}'`}}}}else if(e.attributes){Object.keys($.directives).forEach((i=>{if(!t||t.indexOf(i)===-1){let n=`${$.config.attributePrefix}-${i}`,r=e.getAttribute(n);if(r){let o=$.directives[i];if(!e.$directives){e.$directives={}}this.$getContext(e);e.$directives[i]={name:i,handler:o,parameters:r};if(o.init){o.init.call(this,e,r,this)}}}}));Array.from(e.attributes).forEach((t=>{const i=t.name;const r=t.textContent;const o=r.match(n);if(o!==null){if(!e.$directives){e.$directives={}}let c=e.$directives.attr;let s=c&&c.parameters||"";if(s){s=s.substring(1,s.length-1)+","}s+=`'${i}' : '${r.replace(n,"' + ($1) + '")}'`;s=`{${s}}`;if(c){c.parameters=s}else{e.$directives.attr={name:"attr",handler:$.directives.attr,parameters:s}}}}))}if(e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$parse(e)}))}}$render(e,t){if(e.$directives){Object.keys(e.$directives).forEach(function(i){if(!t||t.indexOf(i)===-1){let n=e.$directives[i],r=n.handler,o=n.parameters;if(r.bind){r.bind.call(this,e,o,this)}if(r.update){r.update.call(this,e,o,this)}}}.bind(this))}if(e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$render(e)}))}}$createContext(e,t,i){o=true;let n=t;if(t instanceof f){n.$this=t;n.$parent=t.$parent;n.$root=this}else{n={$this:t,$parent:t.$parent,$root:this}}let r=this.$getAdditionalContextProperties(e);r.forEach((t=>{if(["$this","$parent","$root"].indexOf(t)!==-1){throw new a(`You cannot apply the key '${t}' as additionnal context property`)}n[t]=e.parentNode.$context[t]}));e.$additionalContextProperties=new Set(Array.from(r));if(i){Object.keys(i).forEach((t=>{n[t]=i[t];e.$additionalContextProperties.add(t)}))}e.$context=n;o=false}$removeContext(e){delete e.$context;if(e.children){Array.from(e.children).forEach((e=>{this.$removeContext(e)}))}}$getContext(e){if(e.$context){return e.$context}let t=this.$getContext(e.parentNode);e.$context=t;return t}$getAdditionalContextProperties(e){if(e.$additionalContextProperties){return e.$additionalContextProperties}if(e===this.$rootElement){return new Set([])}let t=this.$getAdditionalContextProperties(e.parentNode);e.$additionalContextProperties=t;return t}$parseDirectiveGetterParameters(e){return new Function("$context",`
                let $result;

                with($context) {
                    $result=(${e});
                };

                return $result;
            `)}$getDirectiveValue(e,t,i){let n=this.$parseDirectiveGetterParameters(e);try{return n(i||this.$getContext(t))}catch(r){return undefined}}$parseDirectiveSetterParameters(e){return new Function("$context","$value",`
                with($context) {
                    ${e.replace(s,"$this.$1")} = $value;
                }
            `)}$setDirectiveValue(e,t,i){let n=this.$parseDirectiveSetterParameters(e);n(this.$getContext(t),i)}static directive(e,t){this.directives[e]=new l(e,t)}$insertRemoveElement(e,t,i){if(!i){i=e}if(t&&!i.$parent.contains(e)){let n=null;i.$before.every(function(e){if(i.$parent.contains(e)){n=e;return false}return true});if(n){if(n.nextElementSibling){i.$parent.insertBefore(e,n.nextElementSibling)}else{i.$parent.appendChild(e)}}else{i.$parent.insertBefore(e,e.$parent.firstChild)}let o=null;if(r){o=[r.name]}this.$render(e,o)}else if(e.$parent.contains(e)&&!t){e.$parent.removeChild(e)}}}$.directives={},$.directive("show",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.style.display="":e.style.display="none"}}),$.directive("class",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.originalClassList||(e.originalClassList=[],Array.from(e.classList).forEach(function(t){e.originalClassList.push(t)})),Array.from(e.classList).forEach(function(t){-1===e.originalClassList.indexOf(t)&&e.classList.remove(t)}),n&&("string"==typeof n&&(n={[n]:!0}),"object"==typeof n&&Object.keys(n).forEach(function(t){let i=t.split(" "),r=e.classList;i.forEach(function(e){n[t]?r.add(e):r.remove(e)})}))}}),$.directive("style",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.style[t]=i:e.style[t]=""})}}),$.directive("attr",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.setAttribute(t,i):e.removeAttribute(t)})}}),$.directive("disabled",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.setAttribute("disabled",!0):e.removeAttribute("disabled")}}),$.directive("value",{bind:function(e,t,i){e["true"===e.contentEditable?"onblur":"onchange"]=function(){let n,r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":n=Boolean(e.checked);break;case"radio":n=document.querySelector(`input[name="${e.name}"]:checked`).value;break;default:n=e.value}break;case"textarea":n=e.value;break;default:if(e.contentEditable){n=e.innerHTML;break}return}i.$setDirectiveValue(t,e,n)}},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);void 0===n&&(n="");let r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":e.checked=Boolean(n);break;case"radio":let c=document.querySelector(`input[name="${e.name}"][value="${n}"]`);c&&(c.checked=!0);break;default:e.value=n}break;case"textarea":e.value=n;break;default:e.contentEditable?e.innerHTML=n:e.value=n}}}),$.directive("input",{bind:function(e,t,i){e.addEventListener("input",function(){i.$setDirectiveValue(t,e,e.value)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.value=n}}),$.directive("focus",{bind:function(e,t,i){e.addEventListener("focus",function(){i.$setDirectiveValue(t,e,!0)}),e.addEventListener("blur",function(){i.$setDirectiveValue(t,e,!1)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&e!==document.activeElement?e.focus():n||e!==document.activeElement||e.blur()}}),$.directive("options",{update:function(e,t,i){if("select"!==e.nodeName.toLowerCase())throw new a("options directive can be applied only on select tags");let n=i.$getDirectiveValue(t,e),r=n;if(n&&(!("$data"in n)||n.$data)){n.$data&&(r={},Object.keys(n.$data).forEach(function(e){let t=n.$data[e],i=n.$value?t[n.$value]:e,o=n.$label?t[n.$label]:t;r[i]=o}));let o=e.value||n.$selected;e.innerHTML="";let c=function(t,i){let n=document.createElement("option");n.value=t,n.innerText=i,t.toString()===o&&(n.selected=!0),e.appendChild(n)};Object.keys(r).forEach(function(e){let t=r[e];c(e,t)})}}}),$.directive("text",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.innerText=n}}),$.directive("html",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.innerHTML=n,e.childNodes&&Array.from(e.childNodes).forEach((e=>{i.$parse(e),i.$render(e)}))}}),$.directive("click",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t);e.onclick=function(t){let r=i.$getContext(e),o=n(r,t);"function"==typeof o&&o.call(r.$this,r,t)}}}),$.directive("on",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t),r=n(i.$getContext(e));"object"==typeof r&&Object.keys(r).forEach(function(t){let n=r[t],o=`on${t}`;e[o]=function(t){n(i.$getContext(e),t)}})}}),$.directive("submit",{bind:function(e,t,i){if("form"!==e.nodeName.toLowerCase())throw new a("submit directive can be applied only on form tags");let n=i.$parseDirectiveGetterParameters(t);e.addEventListener("submit",function(t){let r=n(i.$getContext(e));"function"==typeof r&&r(i.$getContext(e),t)})}});var h=function(e){e.$before=[],e.previousElementSibling&&(e.$before=[e.previousElementSibling],e.previousElementSibling.$before&&(e.$before=e.$before.concat(e.previousElementSibling.$before))),e.$parent=e.parentNode};$.directive("each",{init:function(t,i){h(t);let n=t.parentNode,r=e();t.$clones=[];let o=document.createElement(t.nodeName);o.$eachElement=t,o.$directives={each:t.$directives.each},delete t.$directives.each,o.setAttribute($.config.attributePrefix+"-each",i),o.id=r,n.replaceChild(o,t)},update:function(e,t,i){let n=e.$eachElement,r=i.$getDirectiveValue(t,n);if(n.$clones.forEach(function(e){e.parentNode&&e.parentNode.contains(e)&&e.parentNode.removeChild(e)}),e.parentNode&&e.parentNode.contains(e)&&e.parentNode.removeChild(e),n.$clones=[],r){let o=r&&Array.from("$data"in r?r.$data:r)||[];o=o.filter((e=>{return e})),r.$filter&&(o=o.filter(r.$filter)),r.$sort&&("function"==typeof r.$sort?o.sort(r.$sort):o.sort(function(e,t){return e[r.$sort]<t[r.$sort]?-1:1})),r.$order&&r.$order<0&&o.reverse();let c=r.$offset||0,s=c+(r.$limit||o.length);o=o.slice(c,s),o.reverse(),o.forEach(function(e,t){let c=o.length-1-t,s={$index:c};r.$item&&(s[`$${r.$item}`]=e);let a=n.cloneNode(!0);a.$parent=n.$parent,a.$directives=n.$directives,delete a.$directives.each,i.$insertRemoveElement(a,!0,n),i.$createContext(a,e,s),n.$clones.push(a),i.$parse(a,["each"]),i.$render(a,["each"])})}}}),$.directive("if",{init:function(e){h(e)},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);i.$insertRemoveElement(e,Boolean(n))}}),$.directive("unless",{init:function(e){h(e)},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);i.$insertRemoveElement(e,!n)}}),$.directive("with",{init:(e,t,i)=>{let n=i.$getDirectiveValue(t,e===i.$rootElement?e:e.parentNode),r={};"$data"in n&&("$as"in n&&(r[`$${n.$as}`]=n.$data),n=n.$data),i.$createContext(e,n,r)},update:(e,t,i)=>{let n,r={};if(e===i.$rootElement)n=i.$getDirectiveValue(t,e,i);else{if(!e.parentNode)return;i.$removeContext(e),n=i.$getDirectiveValue(t,e.parentNode)}"$data"in n&&("$as"in n&&(r[`$${n.$as}`]=n.$data),n=n.$data),i.$createContext(e,n,r),i.$render(e,["with"])}}),$.directive("template",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e),r=i.$templates[n]||"";e.innerHTML=r,e.childNodes&&Array.from(e.childNodes).forEach((t=>{i.$createContext(t,i.$getContext(e)),i.$parse(t),i.$render(t)}))}}),$.config={attributePrefix:"e",delimiters:["${","}"],htmlDelimiters:["!{","}"]},Object.defineProperty($,"version",{value:"1.0.4",writable:!1});const p=Array.isArray;return Array.isArray=function(e){return e instanceof u?!0:p(e)},$});