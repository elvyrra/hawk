/**
 * emv.js v1.1.2
 *
 * @author Elvyrra S.A.S
 * @license http://rem.mit-license.org/ MIT
 */
"use strict";!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EMV=t()}(this,function(){function e(){const e=()=>{return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e){let t=["string","number","boolean","undefined","symbol"];return-1!==t.indexOf(typeof e)||null===e}function i(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}const n=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","if","in","instanceof","new","return","switch","throw","try","typeof","var","void","while","with","class","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield"],r=new RegExp(`\\b(${n.join("|")})\\b`,"g");class o extends Error{constructor(e){let t=`EMV Error : ${e}`;super(t)}}class c{constructor(e,i,n,r){this.$callers={};this.$watchers={};this.$root=i||this;this.$parent=n;this.$computed={};this.$this=this;this.$directives={};let o={get:function(e,t){if(typeof t!=="string"){return e[t]}let i=e[t];if(t.substr(0,1)==="$"){return this[t]}if(this.$root&&typeof i!=="function"){if(this.$root.$executingComputed){if(!this.$callers[t]){this.$callers[t]={}}if(!this.$callers[t][this.$root.$executingComputed.uid]){Object.keys(this.$root.$computed).every(function(e){if(this.$root.$computed[e]===this.$root.$executingComputed){this.$callers[t][this.$root.$executingComputed.uid]={property:e,reader:this.$root.$executingComputed.reader,writer:this.$root.$executingComputed.writer,object:this.$root.$executingComputed.object};return false}return true}.bind(this))}}if(this.$root.$executingDirective){if(!this.$directives[t]){this.$directives[t]=new Set([])}this.$directives[t].add(this.$root.$executingDirective.uid)}}return i}.bind(this),set:function(e,i,n){if(typeof i!=="string"){return true}let o=false;let a=i.substr(0,1)==="$";if(!(i in e)&&!this.$root.$creatingContext){o=true}if(a||typeof n==="function"||n instanceof HTMLElement){e[i]=n;return true}let u=e[i];if(!t(n)&&!(n instanceof c)){if(Array.isArray(n)){e[i]=new s(n,this.$root||e,e,i)}else{e[i]=new c(n,this.$root||e,e,i);if(n.constructor.name!=="Object"){Object.getOwnPropertyNames(n.constructor.prototype).forEach((t=>{if(i!=="constructor"){e[i][t]=n[t]}}))}}}else{e[i]=n;if(n instanceof f){n.$root=this.$root||e;n.$parent=e}}if(this.$computed[i]&&this.$computed[i].writer){try{this.$computed[i].writer(this,n,u)}catch(d){}}if(u!==n){this.$notifySubscribers(i,n,u);if(o&&this.$parent){this.$parent.$notifySubscribers(r,this.$parent)}}return true}.bind(this),deleteProperty:function(e,t){if(typeof t!=="string"){return true}let i=t.substr(0,1)==="$";let n=e[t];delete e[t];if(!i){this.$notifySubscribers(t,undefined,n);if(this.$parent){this.$parent.$notifySubscribers(r,this.$parent)}}return true}.bind(this),ownKeys:function(e){return Object.getOwnPropertyNames(e).filter(function(e){return e.substr(0,1)!=="$"&&(!this instanceof s||e!=="length")})}};let a=new Proxy(this,o);Object.keys(e).forEach(function(t){a[t]=e[t]});return a}$notifySubscribers(e,t,i){if(!e){return}if(t===undefined){t=this[e]}if(this.$callers[e]){Object.keys(this.$callers[e]).forEach(function(t){const i=this.$callers[e][t];i.object[i.property]=i.reader(i.object)}.bind(this))}if(this.$watchers[e]){Object.keys(this.$watchers[e]).forEach(function(n){this.$watchers[e][n].call(this,t,i)}.bind(this))}if(this.$directives[e]){this.$directives[e].forEach(function(t){const i=this.$root.$directives[t];if(!i){this.$directives[e].delete(t);return}if(i&&i.handler.update){i.handler.update(i.element,i.parameters,i.model)}}.bind(this))}}valueOf(){let e={};Object.keys(this).forEach((t=>{e[t]=this[t]?this[t].valueOf():this[t]}));return e}toString(){return JSON.stringify(this.valueOf())}$watch(t,i){if(Array.isArray(t)){t.forEach((e=>{this.$watch(e,i)}));return}let n=t.split("."),r,o=n.pop();r=this.$this;n.forEach(function(e){r=r[e]});if(!r){return}if(!r.$watchers[o]){r.$watchers[o]={}}i.uid=e();r.$watchers[o][i.uid]=i}$unwatch(e,t){let i=e.split("."),n,r=i.pop();n=this.$this;i.forEach(function(e){n=n[e]});if(n.$watchers[r]){if(t){delete n.$watchers[r][t.uid]}else{n.$watchers[r]={}}}}}class s extends c{constructor(e,t,i,n){super(e,t,i,n);this.length=e.length}valueOf(){return Array.from(this).map((e=>{return e?e.valueOf():e}))}}Object.getOwnPropertyNames(Array.prototype).forEach((e=>{s.prototype[e]||(s.prototype[e]=Array.prototype[e])}));class a{constructor(t,i){let n=this;this.uid=e();this.object=i;if(typeof t==="function"){t={read:t}}if(t.write){this.writer=function(e,i,n){t.write.call(e,i,n)}}if(t.read){this.reader=function(e){const r=i.$executingComputed;i.$executingComputed=n;let o;try{o=t.read.call(e)}catch(c){o=undefined}i.$executingComputed=r;return o}}}}class u{constructor(e,t){this.name=e;const i=this;let n=function(n){if(t[n]){this[n]=function(r,o,c){const s=c.$executingDirective;c.$executingDirective={element:r,parameters:o,model:c,handler:i,uid:this.getUid(r),name:e};const a=t[n](r,o,c);c.$executingDirective=s;return a}.bind(this)}}.bind(this);n("init");n("bind");n("update")}getUid(t){if(!t.$uid){t.$uid=e()}return`${t.$uid}-${this.name}`}}class f extends c{constructor(e){const t=e||{};super(t.data||t);this.$templates={};this.$executingComputed=null;this.$executingDirective=null;this.$creatingContext=false;this.$directives={};if(t.computed){Object.keys(t.computed).forEach(function(e){this.$computed[e]=new a(t.computed[e],this)}.bind(this))}Object.keys(this.$computed).forEach((e=>{if(this.$computed[e].reader){this[e]=this.$computed[e].reader(this)}else{this[e]=undefined}}))}$apply(e){if(this.$rootElement){throw new o("an emv instance cannot be instanciated on multiple DOM elements.")}this.$rootElement=e||document.body;this.$createContext(this.$rootElement,this);this.$parse(this.$rootElement);this.$render(this.$rootElement)}$clean(e,t){let i=e||this.$rootElement;if(!i){return}if(i.$directives){Object.keys(i.$directives).forEach((e=>{if(!t||t.indexOf(e)===-1){const n=i.$directives[e];delete this.$directives[n];delete i.$directives[e]}}))}if(i.children){Array.from(i.children).forEach((e=>{this.$clean(e)}))}if(i===this.$rootElement){delete this.$rootElement}}$registerTemplate(e,t){const i=t.replace(/<!\-\-(.*?)\-\->/g,"");this.$templates[e]=i}$parse(e,t){const n=new RegExp(i(f.config.delimiters[0])+"(.+?)"+i(f.config.delimiters[1]),"g");if(e.nodeName.toLowerCase()==="template"){this.$registerTemplate(e.id,e.innerHTML);e.parentNode.removeChild(e)}else if(e.nodeName.toLowerCase()==="#text"){const r=e.textContent;const o=r.match(n);if(o){this.$getContext(e.parentNode);const c=r.replace(n,"${$1}");this.$setElementDirective(e,"text",`\`${c}\``)}}else if(e.attributes){Object.keys(f.directives).forEach((i=>{if((!t||t.indexOf(i)===-1)&&e.getAttribute){const n=`${f.config.attributePrefix}-${i}`;if(e.hasAttribute(n)){const r=e.getAttribute(n);const o=f.directives[i];this.$getContext(e);this.$setElementDirective(e,i,r);if(o.init){o.init.call(this,e,r,this)}}}}));Array.from(e.attributes).forEach((t=>{const i=t.name;const r=t.textContent;const o=r.match(n);if(o!==null){let c=this.$directives[e.$directives&&e.$directives.attr];let s=c&&c.parameters||"";if(s){s=s.substring(1,s.length-1)+","}s+=`'${i}' : \`${r.replace(n,"${$1}")}\``;s=`{${s}}`;this.$setElementDirective(e,"attr",s)}}))}if(e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$parse(e)}))}}$setElementDirective(t,i,n){if(!t.$directives){t.$directives={}}if(!t.$uid){t.$uid=e()}const r=f.directives[i];const o=r.getUid(t);this.$directives[o]={name:i,handler:r,parameters:n,model:this,element:t};t.$directives[i]=o}$render(e,t){e.$stopRenderingPropagation=false;if(e.$directives){Object.keys(e.$directives).forEach(function(i){if((!t||t.indexOf(i)===-1)&&!e.$stopRenderingPropagation){const n=e.$directives[i];const r=this.$directives[n];if(!r){return}const o=r.handler;const c=r.parameters;if(o.bind){o.bind.call(this,e,c,this)}if(o.update){o.update.call(this,e,c,this)}}}.bind(this))}if(!document.documentElement.contains(e)){return}if(!e.$stopRenderingPropagation&&e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$render(e)}))}}$stopRenderingPropagation(e){e.$stopRenderingPropagation=true}$createContext(e,t,i){this.$creatingContext=true;let n=t;if(t instanceof c){n.$this=t;n.$parent=t.$parent;n.$root=this}else{n={$this:t,$parent:t.$parent,$root:this}}let r=this.$getAdditionalContextProperties(e);r.forEach((t=>{if(["$this","$parent","$root"].indexOf(t)!==-1){throw new o(`You cannot apply the key '${t}' as additionnal context property`)}n[t]=(e.parentNode||e.$parent).$context[t]}));e.$additionalContextProperties=new Set(Array.from(r));if(i){Object.keys(i).forEach((t=>{n[t]=i[t];e.$additionalContextProperties.add(t)}))}e.$context=n;this.$creatingContext=false}$removeContext(e){delete e.$context;if(e.children){Array.from(e.children).forEach((e=>{this.$removeContext(e)}))}}$getContext(e){if(!e){return{}}if(e.$context){return e.$context}let t=this.$getContext(e.parentNode);e.$context=t;return t}$getAdditionalContextProperties(e){if(e.$additionalContextProperties){return e.$additionalContextProperties}if(e===this.$rootElement){return new Set([])}const t=e.parentNode||e.$parent;if(t){let i=this.$getAdditionalContextProperties(t);e.$additionalContextProperties=i;return i}return new Set([])}$parseDirectiveGetterParameters(e){return new Function("$context",`
                let $$result;

                with($context) {
                    $$result=(${e});
                };

                return $$result;
            `)}$getDirectiveValue(e,t,i,n){if(!n){n=0}e=e.replace(/\n\s*/g,"");const r=this.$parseDirectiveGetterParameters(e);const o=i||this.$getContext(t);try{return r(o)}catch(c){if(c.name==="ReferenceError"){if(n>10){return undefined}const s=c.stack.split("\n");const a=r.toString().split("\n");const u=c.message.match(/^[a-z\$_][0-9a-z\$_]*/i).pop();const f=s[1].match(/(\d+):(\d+)\)$/);const d=f[1]-1;const l=a[d].indexOf(e);const $=f[2]-1-l;const h=e.substring(0,$)+"$this."+u+e.substring($+u.length);return this.$getDirectiveValue(h,t,o,n+1)}return undefined}}$parseDirectiveSetterParameters(e){return new Function("$context","$value",`
                with($context) {
                    ${e.replace(r,"$this.$1")} = $value;
                }
            `)}$setDirectiveValue(e,t,i){let n=this.$parseDirectiveSetterParameters(e);n(this.$getContext(t),i)}static directive(e,t){this.directives[e]=new u(e,t)}$insertRemoveElement(e,t,i,n,r){const o=n||e;if(t){const c=!o.$parent.contains(e)||r;if(c){let s=null;if(e.$before){e.$before.every(function(e){if(o.$parent.contains(e)){s=e;return false}return true})}if(s){if(s.nextElementSibling){o.$parent.insertBefore(e,s.nextElementSibling)}else{o.$parent.appendChild(e)}}else{o.$parent.insertBefore(e,o.$parent.firstChild)}e.innerHTML=this.$templates[o.$templateName];if(e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$parse(e)}))}this.$render(e,i)}}else{this.$stopRenderingPropagation(e);if(o.$parent.contains(e)){if(e.childNodes){Array.from(e.childNodes).forEach((e=>{this.$clean(e)}))}o.$parent.removeChild(e)}}}}f.directives={},f.directive("show",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.style.display="":e.style.display="none"}}),f.directive("class",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.originalClassList||(e.originalClassList=[],Array.from(e.classList).forEach(function(t){e.originalClassList.push(t)})),Array.from(e.classList).forEach(function(t){-1===e.originalClassList.indexOf(t)&&e.classList.remove(t)}),n&&("string"==typeof n&&(n={[n]:!0}),"object"==typeof n&&Object.keys(n).forEach(function(t){let i=t.split(" "),r=e.classList;i.forEach(function(e){n[t]?r.add(e):r.remove(e)})}))}}),f.directive("style",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.style[t]=i:e.style[t]=""})}}),f.directive("attr",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&"object"==typeof n&&Object.keys(n).forEach(function(t){let i=n[t];i?e.setAttribute(t,i):e.removeAttribute(t)})}}),f.directive("disabled",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n?e.setAttribute("disabled",!0):e.removeAttribute("disabled")}}),f.directive("value",{bind:function(e,t,i){e["true"===e.contentEditable?"onblur":"onchange"]=function(){let n,r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":n=Boolean(e.checked);break;case"radio":n=document.querySelector(`input[name="${e.name}"]:checked`).value;break;default:n=e.value}break;case"textarea":n=e.value;break;default:if(e.contentEditable){n=e.innerHTML;break}return}i.$setDirectiveValue(t,e,n)}},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);void 0===n&&(n="");let r=e.nodeName.toLowerCase(),o=e.type;switch(r){case"input":case"select":switch(o){case"checkbox":e.checked=Boolean(n);break;case"radio":let c=document.querySelector(`input[name="${e.name}"][value="${n}"]`);c&&(c.checked=!0);break;default:e.value=n}break;case"textarea":e.value=n;break;default:e.contentEditable?e.innerHTML=n:e.value=n}}}),f.directive("input",{bind:function(e,t,i){e.addEventListener("input",function(){i.$setDirectiveValue(t,e,e.value)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);e.value=n||""}}),f.directive("focus",{bind:function(e,t,i){e.addEventListener("focus",function(){i.$setDirectiveValue(t,e,!0)}),e.addEventListener("blur",function(){i.$setDirectiveValue(t,e,!1)})},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);n&&e!==document.activeElement?e.focus():n||e!==document.activeElement||e.blur()}}),f.directive("options",{update:function(e,t,i){if("select"!==e.nodeName.toLowerCase())throw new o("options directive can be applied only on select tags");let n=i.$getDirectiveValue(t,e),r=n;if(n&&(!("$data"in n)||n.$data)){n.$data&&(r={},Object.keys(n.$data).forEach(function(e){let t=n.$data[e],i=n.$value?t[n.$value]:e,o=n.$label?t[n.$label]:t;r[i]=o}));let c=e.value||n.$selected;e.innerHTML="";let s=function(t,i){let n=document.createElement("option");n.value=t,n.innerText=i,t.toString()===c&&(n.selected=!0),e.appendChild(n)};Object.keys(r).forEach(function(e){let t=r[e];s(e,t)})}}}),f.directive("text",{update:function(e,t,i){let n=i.$getDirectiveValue(t,e);"#text"===e.nodeName?e.nodeValue=n:e.innerText=n}}),f.directive("html",{update:function(e,t,i){const n=i.$getDirectiveValue(t,e);e.innerHTML=n;const r=e.querySelectorAll("script");Array.from(r).forEach((e=>{if(e.innerText){const t=new Function(e.innerText);t()}else{const i=document.createElement("script");i.src=e.src,e.parentNode.replaceChild(i,e)}}))}}),f.directive("click",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t);e.onclick=function(t){let r=i.$getContext(e),o=n(r,t);"function"==typeof o&&o.call(r.$this,r,t)}}}),f.directive("on",{bind:function(e,t,i){let n=i.$parseDirectiveGetterParameters(t),r=n(i.$getContext(e));"object"==typeof r&&Object.keys(r).forEach(function(t){let n=r[t],o=`on${t}`;e[o]=function(t){n(i.$getContext(e),t)}})}}),f.directive("submit",{bind:function(e,t,i){if("form"!==e.nodeName.toLowerCase())throw new o("submit directive can be applied only on form tags");let n=i.$parseDirectiveGetterParameters(t);e.addEventListener("submit",function(t){let r=n(i.$getContext(e));"function"==typeof r&&r(i.$getContext(e),t)})}});const d=function(t,i){t.$before=[],t.previousElementSibling&&(t.$before=[t.previousElementSibling],t.previousElementSibling.$before&&(t.$before=t.$before.concat(t.previousElementSibling.$before))),t.$parent=t.parentNode;const n=t.innerHTML,r=e();t.$templateName=r,i.$registerTemplate(r,n)};f.directive("each",{init:function(e,t,i){d(e,i),e.$clones=[]},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);if(e.parentNode&&e.parentNode.contains(e)&&e.$parent.removeChild(e),n){let r=n&&Array.from("$data"in n?n.$data||[]:n)||[];r=r.filter((e=>void 0!==e&&null!==e)),n.$filter&&(r=r.filter(n.$filter)),n.$sort&&("function"==typeof n.$sort?r.sort(n.$sort):r.sort(function(e,t){return e[n.$sort]<t[n.$sort]?-1:1})),n.$order&&n.$order<0&&r.reverse();let o=n.$offset||0,c=o+(n.$limit||r.length);r=r.slice(o,c);let s=e.$clones.slice();s.forEach((t=>{-1===r.indexOf(t.$$item)&&t.parentNode&&t.parentNode.contains(t)&&(i.$clean(t),i.$insertRemoveElement(t,!1,null,e))})),e.$clones=[],r.forEach(function(t,o){const c=r.length-1-o,a=s.findIndex((e=>{return e.$$item===t})),u=e.$clones.slice().reverse().concat(e.$before);if(-1!==a){let f=s[a];if(e.$clones.push(f),a===o)return;return f.$before=u,f.$context.$index=c,void i.$insertRemoveElement(f,!0,["each"],e)}let d={$index:c};n.$item&&(d[`$${n.$item}`]=t);const l=e.cloneNode(!0);l.$$item=t,l.$parent=e.$parent,i.$createContext(l,t,d),l.$before=u,Object.keys(e.$directives).forEach((t=>{if("each"!==t){const n=e.$directives[t];i.$setElementDirective(l,t,i.$directives[n].parameters)}})),i.$insertRemoveElement(l,!0,["each"],e),e.$clones.push(l)})}}}),f.directive("if",{init:function(e,t,i){d(e,i)},update:function(e,t,i){let n=Boolean(i.$getDirectiveValue(t,e));i.$insertRemoveElement(e,n,["if"])}}),f.directive("unless",{init:function(e,t,i){d(e,i)},update:function(e,t,i){let n=i.$getDirectiveValue(t,e);i.$insertRemoveElement(e,!n,["unless"])}}),f.directive("with",{init:function(e,t,i){d(e,i)},update:function(e,t,i){let n,r={};if(e===i.$rootElement)n=i.$getDirectiveValue(t,e,i);else{if(!e.$parent)return void i.$stopRenderingPropagation(e);i.$removeContext(e),n=i.$getDirectiveValue(t,e.$parent)}n&&"$data"in n&&("$as"in n&&(r[`$${n.$as}`]=n.$data),n=n.$data),n?(i.$createContext(e,n,r),i.$insertRemoveElement(e,!0,["with"],null,!0)):i.$insertRemoveElement(e,!1)}}),f.directive("template",{update:function(e,t,i){if(document.documentElement.contains(e)){let n=i.$getDirectiveValue(t,e),r=i.$templates[n]||"";e.innerHTML=r;const o=e.querySelectorAll("script");Array.from(o).forEach((e=>{if(e.innerText){const t=new Function(e.innerText);t()}else{const i=document.createElement("script");i.src=e.src,e.parentNode.replaceChild(i,e)}})),e.childNodes&&(Array.from(e.childNodes).forEach((e=>{i.$parse(e)})),Array.from(e.childNodes).forEach((e=>{i.$render(e)})))}}}),f.config={attributePrefix:"e",delimiters:["${","}"]},Object.defineProperty(f,"version",{value:"1.1.2",writable:!1}),f.utils={uid:function(){return e()}};const l=Array.isArray;return Array.isArray=function(e){return e instanceof s?!0:l(e)},f});